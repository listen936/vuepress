# 浏览器的渲染过程

## 进程和线程

* `进程(process)`是CPU资源分配的最小单位，类似于火车。
* `线程(thread)`是CPU调度的最小单位，一个进程可以多个线程，类比车厢。 

## 浏览器的多进程

现代浏览器都是采用的多进程的架构，那么浏览器都有那些进程呢？(RGBP)

1. **`主进程(Browser Process)`** 

    负责浏览器界面的显示和交互；各个页面的管理，创建和销毁其他进程；网络资源的管理、下载等。

2. **`第三方插件进程(Plugin Process)`**

    每种类型的插件都对应一个进程，仅当该插件使用的时候才会创建

3. **`GPU进程(GPU Process)`**

    最多只有一个，用于3D绘制

4. **`渲染进程(Renderer Process)`**

    称为浏览器渲染进程或浏览器内核，内部是多线程的；主要负责页面的渲染、脚本的执行、事件的处理等。

### 渲染进程

上面说到渲染进程内部是多线程的，那么其中主要的线程有哪些呢？

1. **`GUI线程`**

    * 负责渲染浏览器界面，解析HTML、CSS，构建dom树和RenderObject树，布局和绘制
    * 当页面触发绘制(paint)或者由于某些操作引发回流(reflow)时，该线程就会执行
    * 注意： GUI线程和JS引擎线程是互斥的，当JS引擎线程执行时，GUI线程会被挂起（相当于被冻结了），GUI的更新会被保存到一个队列中，等到JS引擎空闲时再执行


2. **`JS引擎线程`**

    * 也称作js内核，负责处理javascript脚本程序（例如V8引擎）
    * JS引擎会一直等待着任务队列中任务的到来
    * 一个进程中无论什么时候都只有一个js线程在运行js程序
    * 注意：GUI线程和JS引擎线程是互斥的，所以js程序运行时间过长的话，会导致页面渲染加载阻塞，从而造成页面渲染不连贯。

3. **`事件触发线程`**

    * 归属于浏览器而不是js引擎，用于控制事件循环（Event Loop),可以理解为js引擎自己忙不过来，需要浏览器再开个线程帮忙
    * 当JS引擎执行类似于setTimeout的代码块时（也可以是来自其他浏览器线程，如鼠标点击、ajax异步请求）会将对应的任务添加到事件线程中
    * 当对应的事件符合触发条件被触发时，该线程会将事件添加到待处理队列的队尾，等待JS引擎的处理
    * 注意：由于JS引擎是的单线程的，所以这些待处理队列都得等js引擎空闲时处理

4. **`定时器触发线程`**

    * setTimeout和setInterval所在的线程
    * 由于JS引擎是单线程的，如果由JS引擎进行计时计数的话，当处于阻塞线程状态时就会影响计时的准确性，所以采用单独线程进行计时
    * 计时完成后会添加到事件队列，等待js引擎的处理
    * 注意：setTimeout中低于4ms的时间将为算为4ms

5. **`异步http请求线程`**

    * 在XMLHttpRequest连接后通过浏览器新开一个线程请求
    * 在检测到状态变更时，如果有回调事件，该线程就会产生状态变更事件，将这个事件放入事件队列中，等待js引擎的处理
    